{"ts":1357659530534,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var express     = require('express');\nvar http        = require('http');\nvar nodemailer  = require('nodemailer');\nvar MemoryStore = require('connect').session.MemoryStore;\nvar app         = express();\nvar dbPath      = 'mongodb://localhost/nodebackbone';\nvar fs          = require('fs');\nvar events      = require('events');\n\n// Create an http server\napp.server      = http.createServer(app);\n\n// Create an event dispatcher\nvar eventDispatcher = new events.EventEmitter();\napp.addEventListener = function ( eventName, callback ) {\n  eventDispatcher.on(eventName, callback);\n};\napp.removeEventListener = function( eventName, callback ) {\n  eventDispatcher.removeListener( eventName, callback );\t\n};\napp.triggerEvent = function( eventName, eventOptions ) {\n  eventDispatcher.emit( eventName, eventOptions );\n};\n\n// Create a session store to share between methods\napp.sessionStore = new MemoryStore();\n\n// Import the data layer\nvar mongoose = require('mongoose');\nvar config = {\n  mail: require('./config/mail')\n};\n\n// Import the models\nvar models = {\n  Account: require('./models/Account')(app, config, mongoose, nodemailer)\n};\n\napp.configure(function(){\n  app.sessionSecret = 'SocialNet secret key';\n  app.set('view engine', 'jade');\n  app.use(express.static(__dirname + '/public'));\n  app.use(express.limit('1mb'));\n  app.use(express.bodyParser());\n  app.use(express.cookieParser());\n  app.use(express.session({\n    secret: app.sessionSecret,\n    key: 'express.sid',\n    store: app.sessionStore\n  }));\n  mongoose.connect(dbPath, function onMongooseError(err) {\n    if (err) throw err;\n  });\n});\n\n// Import the routes\nfs.readdirSync('routes').forEach(function(file) {\n  if ( file[0] == '.' ) return;\n  var routeName = file.substr(0, file.indexOf('.'));\n  require('./routes/' + routeName)(app, models);\n});\n\napp.get('/', function(req, res){\n  res.render('index.jade');\n});\n\napp.post('/contacts/find', function(req, res) {\n  var searchStr = req.param('searchStr', null);\n  if ( null == searchStr ) {\n    res.send(400);\n    return;\n  }\n\n  models.Account.findByString(searchStr, function onSearchDone(err,accounts) {\n    if (err || accounts.length == 0) {\n      res.send(404);\n    } else {\n      res.send(accounts);\n    }\n  });\n});\n\n// New in Chapter 9 - the server listens, instead of the app\napp.server.listen(8080);\nconsole.log('Listening on port 8080');\n"]],"start1":0,"start2":0,"length1":0,"length2":2353}]],"length":2353}
{"contributors":[],"silentsave":false,"ts":1357659819167,"patch":[[{"diffs":[[0,"irSync('"],[1,"./"],[0,"routes')"]],"start1":1625,"start2":1625,"length1":16,"length2":18}]],"length":2355,"saved":false}
{"ts":1357659931689,"patch":[[{"diffs":[[0,"irSync('"],[-1,"./"],[0,"routes')"]],"start1":1625,"start2":1625,"length1":18,"length2":16}]],"length":2353,"saved":false}
{"contributors":[],"silentsave":false,"ts":1357661754428,"patch":[[{"diffs":[[0,"irSync('"],[1,"ch10/"],[0,"routes')"]],"start1":1625,"start2":1625,"length1":16,"length2":21}]],"length":2358,"saved":false}
{"contributors":[],"silentsave":false,"ts":1357663112976,"patch":[[{"diffs":[[0,"b://"],[-1,"localhost/nodebackbone"],[1,"t2k:t2k@mongohq@linus.mongohq.com:10062/t2k"],[0,"';\nv"]],"start1":226,"start2":226,"length1":30,"length2":51}]],"length":2379,"saved":false}
{"contributors":[],"silentsave":false,"ts":1357663249286,"patch":[[{"diffs":[[0,"nc('"],[-1,"ch10/"],[0,"rout"]],"start1":1650,"start2":1650,"length1":13,"length2":8}]],"length":2374,"saved":false}
{"contributors":[],"silentsave":false,"ts":1357670195946,"patch":[[{"diffs":[[0,":t2k"],[-1,"@"],[0,"mongo"],[-1,"hq"],[1,"1"],[0,"@lin"]],"start1":233,"start2":233,"length1":16,"length2":14}]],"length":2372,"saved":false}
{"contributors":[],"silentsave":false,"ts":1357671173881,"patch":[[{"diffs":[[0," null =="],[1,"="],[0," searchS"]],"start1":1993,"start2":1993,"length1":16,"length2":17},{"diffs":[[0,"ength =="],[1,"="],[0," 0) {\n  "]],"start1":2157,"start2":2157,"length1":16,"length2":17}]],"length":2374,"saved":false}
{"contributors":[],"silentsave":false,"ts":1357671834746,"patch":[[{"diffs":[[0,".listen("],[-1,"8080"],[1,"process.env.PORT"],[0,");\nconso"]],"start1":2320,"start2":2320,"length1":20,"length2":32},{"diffs":[[0,"ort "],[-1,"8080'"],[1,"'process.env.PORT"],[0,");\n"]],"start1":2374,"start2":2374,"length1":12,"length2":24}]],"length":2398,"saved":false}
{"ts":1357671847613,"patch":[[{"diffs":[[0,"n port '"],[1,"+ "],[0,"process."]],"start1":2371,"start2":2371,"length1":16,"length2":18}]],"length":2400,"saved":false}
{"ts":1357671881437,"patch":[[{"diffs":[[0,"ning on "],[1,"dynamic "],[0,"port '+ "]],"start1":2365,"start2":2365,"length1":16,"length2":24}]],"length":2408,"saved":false}
{"ts":1357672008559,"patch":[[{"diffs":[[0,"('.'));\n"],[1,"  console.log('adding routes:  '+ routeName);\n"],[0,"  requir"]],"start1":1763,"start2":1763,"length1":16,"length2":62}]],"length":2454,"saved":false}
{"contributors":[],"silentsave":false,"ts":1357693054425,"patch":[[{"diffs":[[0," on "],[-1,"dynamic port"],[1,"process.env.PORT:"],[0," '+ "]],"start1":2415,"start2":2415,"length1":20,"length2":25}]],"length":2459,"saved":false}
{"contributors":[],"silentsave":false,"ts":1358110425383,"patch":[[{"diffs":[[0,"express "],[-1,"    "],[0,"= requir"]],"start1":4,"start2":4,"length1":20,"length2":16},{"diffs":[[0,"ar http "],[-1,"       "],[0,"= requir"]],"start1":35,"start2":35,"length1":23,"length2":16},{"diffs":[[0,"emailer "],[-1," "],[0,"= requir"]],"start1":69,"start2":69,"length1":17,"length2":16},{"diffs":[[0,"var app "],[-1,"        "],[0,"= expres"]],"start1":160,"start2":160,"length1":24,"length2":16},{"diffs":[[0," dbPath "],[-1,"     "],[0,"= 'mongo"]],"start1":184,"start2":184,"length1":21,"length2":16},{"diffs":[[0,"\nvar fs "],[-1,"         "],[0,"= requir"]],"start1":248,"start2":248,"length1":25,"length2":16},{"diffs":[[0," events "],[-1,"     "],[0,"= requir"]],"start1":276,"start2":276,"length1":21,"length2":16},{"diffs":[[0,".server "],[-1,"     "],[0,"= http.c"]],"start1":334,"start2":334,"length1":21,"length2":16},{"diffs":[[0,"function"],[-1," ( "],[1,"("],[0,"eventNam"]],"start1":471,"start2":471,"length1":19,"length2":17},{"diffs":[[0,"ntName, callback"],[-1," "],[0,") {\n"],[1,"  "],[0,"  eventDispatche"]],"start1":483,"start2":483,"length1":37,"length2":38},{"diffs":[[0,"ener = function("],[-1," "],[0,"eventName, callb"]],"start1":570,"start2":570,"length1":33,"length2":32},{"diffs":[[0,"callback"],[-1," "],[0,") {\n  "],[1," "],[1," "],[0,"eventDis"]],"start1":597,"start2":597,"length1":23,"length2":24},{"diffs":[[0,"istener("],[-1," "],[0,"eventNam"]],"start1":636,"start2":636,"length1":17,"length2":16},{"diffs":[[0,"back"],[-1," "],[0,");"],[-1,"\t"],[0,"\n};\n"]],"start1":659,"start2":659,"length1":12,"length2":10},{"diffs":[[0,"unction("],[-1," "],[0,"eventNam"]],"start1":689,"start2":689,"length1":17,"length2":16},{"diffs":[[0,"tOptions"],[-1," "],[0,") {\n  "],[1," "],[1," "],[0,"eventDis"]],"start1":712,"start2":712,"length1":23,"length2":24},{"diffs":[[0,"er.emit("],[-1," "],[0,"eventNam"]],"start1":741,"start2":741,"length1":17,"length2":16},{"diffs":[[0,"tOptions"],[-1," "],[0,");\n};\n\n/"]],"start1":764,"start2":764,"length1":17,"length2":16},{"diffs":[[0,"g = {\n  "],[-1,""],[0,""],[1,"  "],[0,"mail: re"]],"start1":939,"start2":939,"length1":16,"length2":18},{"diffs":[[0,"els = {\n"],[1,"  "],[0,"  Accoun"]],"start1":1012,"start2":1012,"length1":16,"length2":18},{"diffs":[[0,"nction()"],[1," "],[0,"{\n"],[1,"  "],[0,"  app.se"]],"start1":1116,"start2":1116,"length1":18,"length2":21},{"diffs":[[0,"t key';\n"],[1,"  "],[0,"  app.se"]],"start1":1167,"start2":1167,"length1":16,"length2":18},{"diffs":[[0,"jade');\n"],[1,"  "],[0,"  app.us"]],"start1":1203,"start2":1203,"length1":16,"length2":18},{"diffs":[[0,"/public'));\n"],[1,"  "],[0,"  app.use(ex"]],"start1":1251,"start2":1251,"length1":24,"length2":26},{"diffs":[[0,"it('1mb'));\n"],[1,"  "],[0,"  app.use(ex"]],"start1":1286,"start2":1286,"length1":24,"length2":26},{"diffs":[[0,"odyParser());\n  "],[1," "],[1," "],[0,"app.use(express."]],"start1":1319,"start2":1319,"length1":32,"length2":34},{"diffs":[[0,"ser());\n"],[1,"  "],[0,"  app.us"]],"start1":1362,"start2":1362,"length1":16,"length2":18},{"diffs":[[0,"ssion({\n"],[1,"    "],[0,"    secr"]],"start1":1392,"start2":1392,"length1":16,"length2":20},{"diffs":[[0,"Secret,\n"],[1,"    "],[0,"    key:"]],"start1":1427,"start2":1427,"length1":16,"length2":20},{"diffs":[[0,"d',\n    "],[1,"  "],[1,"  "],[0,"store: a"]],"start1":1459,"start2":1459,"length1":16,"length2":20},{"diffs":[[0,"ore\n"],[1,"  "],[0,"  }));\n"],[1,"  "],[0,"  mo"]],"start1":1491,"start2":1491,"length1":15,"length2":19},{"diffs":[[0,"(err) {\n    "],[1," "],[1,"   "],[0,"if (err) thr"]],"start1":1557,"start2":1557,"length1":24,"length2":28},{"diffs":[[0,"ow err;\n"],[1,"  "],[0,"  });\n})"]],"start1":1585,"start2":1585,"length1":16,"length2":18},{"diffs":[[0,"le) {\n  "],[1," "],[1," "],[0,"if ("],[-1," "],[0,"file[0] "]],"start1":1671,"start2":1671,"length1":21,"length2":22},{"diffs":[[0,"] == '.'"],[-1," "],[0,") return"]],"start1":1691,"start2":1691,"length1":17,"length2":16},{"diffs":[[0,"return;\n"],[1,"  "],[0,"  var ro"]],"start1":1701,"start2":1701,"length1":16,"length2":18},{"diffs":[[0,"('.'));\n"],[1,"  "],[0,"  consol"]],"start1":1756,"start2":1756,"length1":16,"length2":18},{"diffs":[[0,"utes:  '"],[1," "],[0,"+ routeN"]],"start1":1790,"start2":1790,"length1":16,"length2":17},{"diffs":[[0,"eName);\n"],[1,"  "],[0,"  requir"]],"start1":1805,"start2":1805,"length1":16,"length2":18},{"diffs":[[0,"eq, res)"],[1," "],[0,"{\n"],[1,"  "],[0,"  res.re"]],"start1":1892,"start2":1892,"length1":18,"length2":21},{"diffs":[[0," res) {\n"],[1,"  "],[0,"  var se"]],"start1":1978,"start2":1978,"length1":16,"length2":18},{"diffs":[[0,"l);\n"],[1,"  "],[0,"  if ("],[-1," "],[0,"null"]],"start1":2032,"start2":2032,"length1":15,"length2":16},{"diffs":[[0,"hStr"],[-1," "],[0,") {\n    "],[1," "],[1,"   "],[0,"res."]],"start1":2058,"start2":2058,"length1":17,"length2":20},{"diffs":[[0,"d(400);\n"],[1,"    "],[0,"    retu"]],"start1":2081,"start2":2081,"length1":16,"length2":20},{"diffs":[[0,"rn;\n"],[1,"  "],[0,"  }\n\n"],[1,"  "],[0,"  mo"]],"start1":2101,"start2":2101,"length1":13,"length2":17},{"diffs":[[0,"one(err,"],[1," "],[0,"accounts"]],"start1":2173,"start2":2173,"length1":16,"length2":17},{"diffs":[[0,"unts) {\n    "],[1,"  "],[1,"  "],[0,"if (err || a"]],"start1":2186,"start2":2186,"length1":24,"length2":28},{"diffs":[[0," === 0) {\n      "],[1,"    "],[1,"  "],[0,"res.send(404);\n "]],"start1":2228,"start2":2228,"length1":32,"length2":38},{"diffs":[[0,"    "],[-1,"}"],[1,"    }\n       "],[0," else {\n"],[1,"      "],[0,"    "]],"start1":2265,"start2":2265,"length1":17,"length2":35},{"diffs":[[0,"s);\n    "],[-1,"}\n"],[1,"    }\n  "],[0,"  });\n})"]],"start1":2318,"start2":2318,"length1":18,"length2":24},{"diffs":[[0,".PORT: '"],[-1,""],[0,""],[1," "],[0,"+ proces"]],"start1":2480,"start2":2480,"length1":16,"length2":17}]],"length":2510,"saved":false}
{"contributors":[],"silentsave":false,"ts":1358122210085,"patch":[[{"diffs":[[0,"e routes"],[1," ... clever"],[0,"\n"],[-1,""],[0,"fs.readd"]],"start1":1618,"start2":1618,"length1":17,"length2":28},{"diffs":[[0,"le[0] =="],[1,"="],[0," '.') re"]],"start1":1698,"start2":1698,"length1":16,"length2":17},{"diffs":[[0,"));\n    "],[1,"//"],[0,"console."]],"start1":1772,"start2":1772,"length1":16,"length2":18},{"diffs":[[0,"dels);\n});\n\n"],[1,"\n"],[0,"app.get('/',"]],"start1":1871,"start2":1871,"length1":24,"length2":25},{"diffs":[[0,"jade');\n"],[-1,""],[0,"});\n\n"],[1,"\n"],[0,"app.post"]],"start1":1940,"start2":1940,"length1":21,"length2":22}]],"length":2526,"saved":false}
{"contributors":[],"silentsave":false,"ts":1376016820519,"patch":[[{"diffs":[[0,"fig/mail"],[1,".example"],[0,"')\n};\n\n/"]],"start1":969,"start2":969,"length1":16,"length2":24}]],"length":2534,"saved":false}
