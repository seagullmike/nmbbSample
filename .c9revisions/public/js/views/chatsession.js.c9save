{"ts":1358111034762,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"define(['SocialNetView', 'text!templates/chatsession.html'],\nfunction(SocialNetView, chatItemTemplate) {\n  var chatItemView = SocialNetView.extend({\n    tagName: 'div',\n\n    className: 'chat_session',\n\n    $el: $(this.el),\n\n    events: {\n      'submit form': 'sendChat'\n    },\n\n    initialize: function(options) {\n      this.socketEvents = options.socketEvents;\n      var accountId = this.model.get('accountId');\n      this.socketEvents.on('socket:chat:in:' + accountId, this.receiveChat, this);\n      this.socketEvents.bind(\n        'login:' + accountId,\n        this.handleContactLogin,\n        this\n      );\n      this.socketEvents.bind(\n        'logout:' + accountId,\n        this.handleContactLogout,\n        this\n      );\n    },\n\n    handleContactLogin: function() {\n      this.$el.find('.online_indicator').addClass('online');\n      this.model.set('online', true);\n    },\n\n    handleContactLogout: function() {\n      this.model.set('online', false);\n      $onlineIndicator = this.$el.find('.online_indicator');\n      while ( $onlineIndicator.hasClass('online') ) {\n        $onlineIndicator.removeClass('online');\n      }\n    },\n\n    receiveChat: function(data) {\n      var chatLine = this.model.get('name').first + ': ' + data.text;\n      this.$el.find('.chat_log').append($('<li>' + chatLine + '</li>'));\n    },\n\n    sendChat: function() {\n      var chatText = this.$el.find('input[name=chat]').val();\n      if ( chatText && /[^\\s]+/.test(chatText) ) {\n        var chatLine = 'Me: ' + chatText;\n        this.$el.find('.chat_log').append($('<li>' + chatLine + '</li>'));\n        this.socketEvents.trigger('socket:chat', {\n          to: this.model.get('accountId'),\n          text: chatText\n        });\n      }\n      return false;\n    },\n\n    render: function() {\n      this.$el.html(_.template(chatItemTemplate, {\n        model: this.model.toJSON()\n      }));\n      if ( this.model.get('online') ) this.handleContactLogin();\n      return this;\n    }\n  });\n\n  return chatItemView;\n});"]],"start1":0,"start2":0,"length1":0,"length2":1990}]],"length":1990}
{"contributors":[],"silentsave":false,"ts":1358111040722,"patch":[[{"diffs":[[0,"html'],\n"],[1,"\n"],[0,"function"]],"start1":53,"start2":53,"length1":16,"length2":17},{"diffs":[[0,"late) {\n"],[1,"  "],[0,"  var ch"]],"start1":98,"start2":98,"length1":16,"length2":18},{"diffs":[[0,"xtend({\n"],[1,"    "],[0,"    tagN"]],"start1":144,"start2":144,"length1":16,"length2":20},{"diffs":[[0,"me: 'div',\n\n"],[1,"    "],[0,"    classNam"]],"start1":165,"start2":165,"length1":24,"length2":28},{"diffs":[[0,"_session',\n\n"],[1,"    "],[0,"    $el: $(t"]],"start1":201,"start2":201,"length1":24,"length2":28},{"diffs":[[0,"s.el),\n\n"],[1,"    "],[0,"    even"]],"start1":231,"start2":231,"length1":16,"length2":20},{"diffs":[[0,"{\n      "],[1,"  "],[1,"    "],[0,"'submit "]],"start1":255,"start2":255,"length1":16,"length2":22},{"diffs":[[0,"ndChat'\n"],[1,"    "],[0,"    },\n\n"]],"start1":287,"start2":287,"length1":16,"length2":20},{"diffs":[[0,"},\n\n    "],[1,"  "],[1,"  "],[0,"initiali"]],"start1":303,"start2":303,"length1":16,"length2":20},{"diffs":[[0,"(options) {\n"],[1,"      "],[0,"      this.s"]],"start1":335,"start2":335,"length1":24,"length2":30},{"diffs":[[0,"ents;\n      "],[1,"  "],[1,"    "],[0,"var accountI"]],"start1":395,"start2":395,"length1":24,"length2":30},{"diffs":[[0,"ccountId');\n"],[1,"      "],[0,"      this.s"]],"start1":446,"start2":446,"length1":24,"length2":30},{"diffs":[[0," this);\n"],[1,"      "],[0,"      th"]],"start1":539,"start2":539,"length1":16,"length2":22},{"diffs":[[0,"Events.bind("],[-1,"\n        "],[0,"'login:' + a"]],"start1":570,"start2":570,"length1":33,"length2":24},{"diffs":[[0,":' + accountId,\n"],[1,"    "],[0,"        this.han"]],"start1":588,"start2":588,"length1":32,"length2":36},{"diffs":[[0,"in,\n        "],[1," "],[1,"   "],[0,"this"],[1,");"],[0,"\n      "],[-1,");\n"],[0,"      this.s"]],"start1":637,"start2":637,"length1":38,"length2":41},{"diffs":[[0,"ts.bind("],[-1,"\n        "],[0,"'logout:"]],"start1":687,"start2":687,"length1":25,"length2":16},{"diffs":[[0,"ountId,\n        "],[1,"  "],[1,"  "],[0,"this.handleConta"]],"start1":710,"start2":710,"length1":32,"length2":36},{"diffs":[[0,"    "],[1,"    "],[0,"this"],[1,");"],[0,"\n    "],[-1,"  );\n"],[0,"    },\n\n"],[1,"    "],[0,"    "]],"start1":760,"start2":760,"length1":30,"length2":35},{"diffs":[[0,"ction() {\n      "],[1,"   "],[1,"   "],[0,"this.$el.find('."]],"start1":818,"start2":818,"length1":32,"length2":38},{"diffs":[[0,"('online');\n"],[1,"      "],[0,"      this.m"]],"start1":883,"start2":883,"length1":24,"length2":30},{"diffs":[[0," true);\n    "],[1," "],[1,"   "],[0,"},\n\n"],[1,"    "],[0,"    handleCo"]],"start1":931,"start2":931,"length1":28,"length2":36},{"diffs":[[0,"n() {\n      "],[1,"   "],[1,"   "],[0,"this.model.s"]],"start1":987,"start2":987,"length1":24,"length2":30},{"diffs":[[0,"e', false);\n"],[1,"      "],[0,"      $onlin"]],"start1":1026,"start2":1026,"length1":24,"length2":30},{"diffs":[[0,"    "],[1," "],[1,"     "],[0,"while ("],[-1," "],[0,"$onl"]],"start1":1107,"start2":1107,"length1":16,"length2":21},{"diffs":[[0,"online')"],[-1," "],[0,") {\n    "]],"start1":1151,"start2":1151,"length1":17,"length2":16},{"diffs":[[0,"ne')) {\n        "],[1,"   "],[1,"     "],[0,"$onlineIndicator"]],"start1":1155,"start2":1155,"length1":32,"length2":40},{"diffs":[[0,"    "],[1,"    "],[-1,"}\n"],[1,"  }\n   "],[0,"    "],[1," "],[0,"},\n\n"],[1,"    "],[0,"    "]],"start1":1221,"start2":1221,"length1":18,"length2":32},{"diffs":[[0,"ion(data) {\n"],[1,"      "],[0,"      var ch"]],"start1":1271,"start2":1271,"length1":24,"length2":30},{"diffs":[[0,"text;\n      "],[1,"    "],[1,"  "],[0,"this.$el.fin"]],"start1":1353,"start2":1353,"length1":24,"length2":30},{"diffs":[[0,"li>'));\n    "],[-1,"},\n\n"],[1,"    },\n\n    "],[0,"    sendChat"]],"start1":1430,"start2":1430,"length1":28,"length2":36},{"diffs":[[0,"unction() {\n"],[1,"      "],[0,"      var ch"]],"start1":1469,"start2":1469,"length1":24,"length2":30},{"diffs":[[0,";\n      "],[1,"    "],[1,"  "],[0,"if ("],[-1," "],[0,"chatText"]],"start1":1547,"start2":1547,"length1":21,"length2":26},{"diffs":[[0,"hatText)"],[-1," "],[0,") {\n    "]],"start1":1592,"start2":1592,"length1":17,"length2":16},{"diffs":[[0,"ext)) {\n        "],[1,"      "],[1,"  "],[0,"var chatLine = '"]],"start1":1596,"start2":1596,"length1":32,"length2":40},{"diffs":[[0,"+ chatText;\n"],[1,"        "],[0,"        this"]],"start1":1642,"start2":1642,"length1":24,"length2":32},{"diffs":[[0,"ne + '</li>'));\n"],[1,"        "],[0,"        this.soc"]],"start1":1721,"start2":1721,"length1":32,"length2":40},{"diffs":[[0,"et:chat', {\n"],[1,"          "],[0,"          to"]],"start1":1784,"start2":1784,"length1":24,"length2":34},{"diffs":[[0,"        "],[1," "],[1,"         "],[0,"text: ch"]],"start1":1851,"start2":1851,"length1":16,"length2":26},{"diffs":[[0,"        "],[1," "],[1,"       "],[0,"});\n    "]],"start1":1884,"start2":1884,"length1":16,"length2":24},{"diffs":[[0,"  });\n      "],[1,"   "],[-1,"}\n"],[1,"   }\n      "],[0,"      return"]],"start1":1898,"start2":1898,"length1":26,"length2":38},{"diffs":[[0," false;\n    "],[1," "],[1,"   "],[0,"},\n\n"],[1,"    "],[0,"    render: "]],"start1":1936,"start2":1936,"length1":28,"length2":36},{"diffs":[[0,"n() {\n      "],[1,"   "],[1,"   "],[0,"this.$el.htm"]],"start1":1979,"start2":1979,"length1":24,"length2":30},{"diffs":[[0,"        "],[1,"       "],[1," "],[0,"model: t"]],"start1":2042,"start2":2042,"length1":16,"length2":24},{"diffs":[[0,"oJSON()\n"],[1,"      "],[0,"      })"]],"start1":2077,"start2":2077,"length1":16,"length2":22},{"diffs":[[0,"    "],[1,"   "],[1,"   "],[0,"if ("],[-1," "],[0,"this"]],"start1":2104,"start2":2104,"length1":13,"length2":18},{"diffs":[[0,"online')"],[-1," "],[0,") this.h"]],"start1":2134,"start2":2134,"length1":17,"length2":16},{"diffs":[[0,"in();\n      "],[1,"     "],[1," "],[0,"return this;"]],"start1":2165,"start2":2165,"length1":24,"length2":30},{"diffs":[[0,"is;\n"],[1,"    "],[0,"    }\n"],[1,"  "],[0,"  });\n\n"],[1,"  "],[0,"  re"]],"start1":2192,"start2":2192,"length1":21,"length2":29}]],"length":2243,"saved":false}
