{"ts":1357692294401,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"define(['Sockets', 'models/contactcollection', 'views/chat'],\nfunction(sio, ContactCollection, ChatView) {\n  var SocialNetSockets = function(eventDispatcher) {\n    var accountId = null;\n\n    var socket = null;\n\n    var connectSocket = function(socketAccountId) {\n      accountId = socketAccountId;\n      socket = io.connect();\n\n      socket\n        .on('connect_failed', function(reason) {\n          console.error('unable to connect', reason);\n        })\n        .on('connect', function() {\n          eventDispatcher.bind('socket:chat', sendChat);\n          socket.on('chatserver', function(data) {\n            eventDispatcher.trigger('socket:chat:start:' + data.from );\n            eventDispatcher.trigger('socket:chat:in:' + data.from, data);\n          });\n\n          socket.on('contactEvent', handleContactEvent);\n\n          var contactsCollection = new ContactCollection();\n          contactsCollection.url = '/accounts/me/contacts';\n          new ChatView({collection: contactsCollection,\n                        socketEvents: eventDispatcher}).render();\n          contactsCollection.fetch();\n        });\n    };\n\n    var handleContactEvent = function(eventObj) {\n      var eventName = eventObj.action + ':' + eventObj.from;\n      eventDispatcher.trigger(eventName, eventObj);\n\n      if ( eventObj.from == accountId ) {\n        eventName = eventObj.action + ':me';\n        eventDispatcher.trigger(eventName, eventObj);\n      }\n    };\n\n    var sendChat = function(payload) {\n      if ( null != socket ) {\n        socket.emit('chatclient', payload);\n      }\n    };\n\n    eventDispatcher.bind('app:loggedin', connectSocket);\n  }\n\n  return {\n    initialize: function(eventDispatcher) {\n      SocialNetSockets(eventDispatcher);\n    }\n  };\n});\n"]],"start1":0,"start2":0,"length1":0,"length2":1741}]],"length":1741}
{"contributors":[],"silentsave":false,"ts":1357692322343,"patch":[[{"diffs":[[0,"els/"],[-1,"c"],[1,"C"],[0,"ontact"],[-1,"c"],[1,"C"],[0,"olle"]],"start1":23,"start2":23,"length1":16,"length2":16}]],"length":1741,"saved":false}
{"contributors":[],"silentsave":false,"ts":1357703197273,"patch":[[{"diffs":[[0,"ocket = "],[1,"s"],[0,"io.conne"]],"start1":305,"start2":305,"length1":16,"length2":17}]],"length":1742,"saved":false}
{"ts":1357706617326,"patch":[[{"diffs":[[0," null !="],[1,"="],[0," socket "]],"start1":1489,"start2":1489,"length1":16,"length2":17}]],"length":1743,"saved":false}
{"contributors":[],"silentsave":false,"ts":1357775532868,"patch":[[{"diffs":[[0,"ocket = "],[-1,"s"],[0,"io.conne"]],"start1":305,"start2":305,"length1":17,"length2":16}]],"length":1742,"saved":false}
{"contributors":[],"silentsave":false,"ts":1357872214737,"patch":[[{"diffs":[[0,"unction() {\n"],[1,"            console.log('socket.io:connect--from client');\n"],[0,"          ev"]],"start1":479,"start2":479,"length1":24,"length2":83}]],"length":1801,"saved":false}
{"ts":1357872227240,"patch":[[{"diffs":[[0,"nt');\n          "],[1,"  "],[0,"eventDispatcher."]],"start1":544,"start2":544,"length1":32,"length2":34},{"diffs":[[0,"hat);\n          "],[1,"  "],[0,"socket.on('chats"]],"start1":603,"start2":603,"length1":32,"length2":34},{"diffs":[[0,") {\n            "],[1,"  "],[1,"  "],[0,"eventDispatcher."]],"start1":658,"start2":658,"length1":32,"length2":36},{"diffs":[[0,"from );\n"],[1,"    "],[0,"        "]],"start1":730,"start2":730,"length1":16,"length2":20}]],"length":1813,"saved":false}
{"ts":1357872754216,"patch":[[{"diffs":[[0,"ountId;\n"],[1,"      console.log('SocialNetSockets: '+socketAccountId  );\n      console.dir(io);\n      \n      \n"],[0,"      so"]],"start1":290,"start2":290,"length1":16,"length2":112}]],"length":1909,"saved":false}
{"ts":1357872905832,"patch":[[{"diffs":[[0,"    "],[-1,"console.dir(io);"],[0,"\n   "]],"start1":359,"start2":359,"length1":24,"length2":8},{"diffs":[[0,"nnect();"],[1,"\n      console.dir(socket);"],[0,"\n\n      "]],"start1":398,"start2":398,"length1":16,"length2":43}]],"length":1920,"saved":false}
{"contributors":[],"silentsave":false,"ts":1358110524502,"patch":[[{"diffs":[[0,"chat'],\n"],[1,"\n"],[0,"function"]],"start1":54,"start2":54,"length1":16,"length2":17},{"diffs":[[0,"View) {\n"],[1,"  "],[0,"  var So"]],"start1":100,"start2":100,"length1":16,"length2":18},{"diffs":[[0,"spatcher) {\n"],[1,"    "],[0,"    var acco"]],"start1":151,"start2":151,"length1":24,"length2":28},{"diffs":[[0,"ountId = null;\n\n"],[1,"    "],[0,"    var socket ="]],"start1":178,"start2":178,"length1":32,"length2":36},{"diffs":[[0,"et = null;\n\n"],[1,"    "],[0,"    var conn"]],"start1":210,"start2":210,"length1":24,"length2":28},{"diffs":[[0,"{\n      "],[1,"     "],[1," "],[0,"accountI"]],"start1":276,"start2":276,"length1":16,"length2":22},{"diffs":[[0,"ccountId;\n      "],[1,"    "],[1,"  "],[0,"console.log('Soc"]],"start1":309,"start2":309,"length1":32,"length2":38},{"diffs":[[0,"ckets: '"],[-1,"+"],[1," + "],[0,"socketAc"]],"start1":355,"start2":355,"length1":17,"length2":19},{"diffs":[[0,"ntId"],[-1,"  "],[0,");\n"],[-1,"      \n      "],[1,"\n\n"],[0,"\n      "],[-1,"\n"],[0,"    "]],"start1":377,"start2":377,"length1":34,"length2":20},{"diffs":[[0,"ct();\n      "],[1,"  "],[1,"    "],[0,"console.dir("]],"start1":416,"start2":416,"length1":24,"length2":30},{"diffs":[[0,"    "],[-1,"socket\n  "],[0,"      "],[1,"socket"],[0,".on("]],"start1":458,"start2":458,"length1":23,"length2":20},{"diffs":[[0,"n(reason) {\n"],[1,"      "],[0,"          co"]],"start1":503,"start2":503,"length1":24,"length2":30},{"diffs":[[0,"    "],[-1,"})\n"],[0,"    "],[-1,"    "],[1,"})"],[0,".on("]],"start1":579,"start2":579,"length1":19,"length2":14},{"diffs":[[0,") {\n            "],[1,"   "],[1," "],[0,"console.log('soc"]],"start1":613,"start2":613,"length1":32,"length2":36},{"diffs":[[0,"ient');\n"],[1,"    "],[0,"        "]],"start1":672,"start2":672,"length1":16,"length2":20},{"diffs":[[0,"dChat);\n"],[1,"    "],[0,"        "]],"start1":735,"start2":735,"length1":16,"length2":20},{"diffs":[[0,"                "],[1,"    "],[0,"eventDispatcher."]],"start1":800,"start2":800,"length1":32,"length2":36},{"diffs":[[0,"from"],[-1," "],[0,");\n"],[1,"    "],[0,"    "]],"start1":872,"start2":872,"length1":12,"length2":15},{"diffs":[[0,";\n          "],[1,"      "],[0,"});\n\n       "]],"start1":959,"start2":959,"length1":24,"length2":30},{"diffs":[[0," });\n\n          "],[1,"   "],[1,"   "],[0,"socket.on('conta"]],"start1":976,"start2":976,"length1":32,"length2":38},{"diffs":[[0,"actEvent);\n\n"],[1,"      "],[0,"          va"]],"start1":1034,"start2":1034,"length1":24,"length2":30},{"diffs":[[0,"on();\n          "],[1,"      "],[0,"contactsCollecti"]],"start1":1106,"start2":1106,"length1":32,"length2":38},{"diffs":[[0,"        "],[1,"   "],[1,"   "],[0,"new Chat"]],"start1":1180,"start2":1180,"length1":16,"length2":22},{"diffs":[[0,"atView({"],[1,"\n                    "],[0,"collecti"]],"start1":1200,"start2":1200,"length1":16,"length2":37},{"diffs":[[0,"            "],[-1,"    "],[0,"socketEvents"]],"start1":1269,"start2":1269,"length1":28,"length2":24},{"diffs":[[0,"spatcher"],[1,"\n                "],[0,"}).rende"]],"start1":1302,"start2":1302,"length1":16,"length2":33},{"diffs":[[0,").render();\n"],[1,"      "],[0,"          co"]],"start1":1328,"start2":1328,"length1":24,"length2":30},{"diffs":[[0,"on.fetch();\n"],[1,"    "],[0,"        });\n"]],"start1":1372,"start2":1372,"length1":24,"length2":28},{"diffs":[[0,"    });\n    "],[-1,"};\n\n"],[1,"    };\n\n    "],[0,"    var hand"]],"start1":1392,"start2":1392,"length1":28,"length2":36},{"diffs":[[0,"bj) {\n      "],[1," "],[1,"     "],[0,"var eventNam"]],"start1":1460,"start2":1460,"length1":24,"length2":30},{"diffs":[[0,"from;\n      "],[1,"    "],[1,"  "],[0,"eventDispatc"]],"start1":1527,"start2":1527,"length1":24,"length2":30},{"diffs":[[0,"eventObj);\n\n"],[1,"      "],[0,"      if ( e"]],"start1":1580,"start2":1580,"length1":24,"length2":30},{"diffs":[[0,"    if ("],[-1," "],[0,"eventObj"]],"start1":1600,"start2":1600,"length1":17,"length2":16},{"diffs":[[0,"ccountId"],[-1," "],[0,") {\n"],[1,"        "],[0,"        "]],"start1":1626,"start2":1626,"length1":21,"length2":28},{"diffs":[[0," ':me';\n"],[1,"        "],[0,"        "]],"start1":1683,"start2":1683,"length1":16,"length2":24},{"diffs":[[0,"Obj);\n      "],[-1,"}\n"],[1,"      }\n    "],[0,"    };\n\n"],[1,"    "],[0,"    var send"]],"start1":1747,"start2":1747,"length1":34,"length2":48},{"diffs":[[0,"(payload) {\n"],[1,"      "],[0,"      if ( n"]],"start1":1810,"start2":1810,"length1":24,"length2":30},{"diffs":[[0,"    if ("],[-1," "],[0,"null !=="]],"start1":1830,"start2":1830,"length1":17,"length2":16},{"diffs":[[0,"= socket"],[-1," "],[0,") {\n    "]],"start1":1845,"start2":1845,"length1":17,"length2":16},{"diffs":[[0,") {\n        "],[1,"      "],[1,"  "],[0,"socket.emit("]],"start1":1853,"start2":1853,"length1":24,"length2":32},{"diffs":[[0,"yload);\n"],[1,"      "],[0,"      }\n"]],"start1":1901,"start2":1901,"length1":16,"length2":22},{"diffs":[[0,"      }\n    "],[1," "],[1,"   "],[0,"};\n\n"],[1,"    "],[0,"    eventDis"]],"start1":1915,"start2":1915,"length1":28,"length2":36},{"diffs":[[0,"t);\n"],[1,"  "],[0,"  }\n\n"],[1,"  "],[0,"  re"]],"start1":1992,"start2":1992,"length1":13,"length2":17},{"diffs":[[0,"eturn {\n"],[1,"    "],[0,"    init"]],"start1":2008,"start2":2008,"length1":16,"length2":20},{"diffs":[[0,"{\n      "],[1,"   "],[1,"   "],[0,"SocialNe"]],"start1":2062,"start2":2062,"length1":16,"length2":22},{"diffs":[[0,"r);\n    "],[-1,"}\n"],[1,"    }\n  "],[0,"  };\n});"]],"start1":2107,"start2":2107,"length1":18,"length2":24}]],"length":2132,"saved":false}
{"contributors":[],"silentsave":false,"ts":1358121880253,"patch":[[{"diffs":[[0,"ocket = "],[1,"s"],[0,"io.conne"]],"start1":400,"start2":400,"length1":16,"length2":17}]],"length":2133,"saved":false}
{"ts":1358122272668,"patch":[[{"diffs":[[0,"ntId);\n\n"],[-1,"\n\n"],[0,"        "]],"start1":377,"start2":377,"length1":18,"length2":16}]],"length":2131,"saved":false}
{"ts":1358122652293,"patch":[[{"diffs":[[0,"    var "],[-1,"c"],[1,"myC"],[0,"ontacts"],[-1,"Collection"],[0," = new C"]],"start1":1057,"start2":1057,"length1":34,"length2":26},{"diffs":[[0,"        "],[-1,"c"],[1,"myC"],[0,"ontacts"],[-1,"Collection"],[0,".url = '"]],"start1":1111,"start2":1111,"length1":34,"length2":26},{"diffs":[[0,"ection: "],[-1,"c"],[1,"myC"],[0,"ontacts"],[-1,"Collection"],[0,",\n      "]],"start1":1216,"start2":1216,"length1":34,"length2":26},{"diffs":[[0,"    "],[-1,"c"],[1,"myC"],[0,"ontacts"],[-1,"Collection"],[0,".fet"]],"start1":1327,"start2":1327,"length1":26,"length2":18}]],"length":2099,"saved":false}
{"contributors":[],"silentsave":false,"ts":1358131012729,"patch":[[{"diffs":[[0,"countId = null;\n"],[-1,"\n"],[0,"        var sock"]],"start1":177,"start2":177,"length1":33,"length2":32},{"diffs":[[0,");\n    }"],[1,";"],[0,"\n\n    re"]],"start1":1959,"start2":1959,"length1":16,"length2":17}]],"length":2099,"saved":false}
{"ts":1358131044906,"patch":[[{"diffs":[[0,"();\n            "],[1,"//"],[0,"console.dir(sock"]],"start1":416,"start2":416,"length1":32,"length2":34}]],"length":2101,"saved":false}
{"contributors":[],"silentsave":false,"ts":1358181723732,"patch":[[{"diffs":[[0,"untId);\n"],[-1,"\n"],[0,"        "]],"start1":375,"start2":375,"length1":17,"length2":16},{"diffs":[[0,"t();"],[-1,"\n            //console.dir(socket);"],[0,"\n\n  "]],"start1":414,"start2":414,"length1":43,"length2":8},{"diffs":[[0,"      })"],[1,";\n\n            socket"],[0,".on('con"]],"start1":545,"start2":545,"length1":16,"length2":37}]],"length":2086,"saved":false}
{"contributors":[],"silentsave":false,"ts":1364747014041,"patch":[[{"diffs":[[0,"patcher."],[-1,"bind"],[1,"on"],[0,"('socket"]],"start1":689,"start2":689,"length1":20,"length2":18},{"diffs":[[0,"her."],[-1,"bind"],[1,"on"],[0,"('ap"]],"start1":1906,"start2":1906,"length1":12,"length2":10}]],"length":2082,"saved":false}
{"contributors":[],"silentsave":false,"ts":1364748739422,"patch":[[{"diffs":[[0,"s.fetch("],[1,"{reset:true}"],[0,");\n     "]],"start1":1324,"start2":1324,"length1":16,"length2":28}]],"length":2094,"saved":false}
